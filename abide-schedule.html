<!DOCTYPE html>
<html lang="zh">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>小组聚会时间表</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <style>
        /* Custom header background color */
        .custom-header {
            background-color: #65CC01 !important;
            color: black !important;
        }

        th.custom-header {
            background-color: #65CC01 !important;
            color: black !important;
        }

        /* Remove underline from links in the "主题" column */
        .topic-link {
            text-decoration: none !important;
            color: #1AC06F !important;
            /* Light gray color */
        }

        /* Optional: Change color when hovering over links */
        .topic-link:hover {
            text-decoration: underline !important;
            color: #1AC06F !important;
            /* Light gray color */
        }

        /* Responsive table adjustments */
        @media (max-width: 768px) {
            table {
                font-size: 14px;
                /* Reduce font size for mobile */
            }

            th,
            td {
                padding: 8px;
                /* Reduce padding */
                white-space: nowrap;
                /* Prevent text from wrapping */
            }
        }
    </style>
    <script>
        // Google Sheets CSV link
        const csvUrl = "https://docs.google.com/spreadsheets/d/e/2PACX-1vR--Fm79_SZ80uh-85kooOXRS-FlgRwN-S0OQhqqm62FSwbXcPGdUnvIQmi-7yLrlrDbQrMugJ5jq9M/pub?gid=0&single=true&output=csv";

        function fetchAndRenderTable() {
            fetch(csvUrl)
                .then(response => response.text())
                .then(csvText => {
                    Papa.parse(csvText, {
                        header: true,
                        skipEmptyLines: true,
                        complete: function (result) {
                            console.log("Parsed CSV data:", result.data); // Debugging
                            generateTable(result.data);
                        }
                    });
                })
                .catch(error => console.error("Error fetching CSV:", error));
        }

        function generateTable(data) {
            let tbody = document.querySelector("#data-table tbody");
            if (!tbody) {
                console.error("Table body not found");
                return;
            }

            tbody.innerHTML = ""; // Clear existing content

            data.forEach(row => {
                let tr = document.createElement("tr");

                let dateTd = document.createElement("td");
                dateTd.textContent = row["日期"] || "—";

                let topicTd = document.createElement("td");
                if (row["下载"]) {
                    // If there's a URL, make "主题" a clickable link
                    let link = document.createElement("a");
                    link.href = row["下载"];
                    link.target = "_blank"; // Open in a new tab
                    link.classList.add("topic-link"); // Apply styling class
                    link.textContent = row["主题"] || "—";
                    topicTd.appendChild(link);
                } else {
                    topicTd.textContent = row["主题"] || "—";
                }

                let locationTd = document.createElement("td");
                locationTd.textContent = row["地点"] || "—";

                let leaderTd = document.createElement("td");
                leaderTd.textContent = row["带领"] || "—";

                tr.appendChild(dateTd);
                tr.appendChild(topicTd);
                tr.appendChild(locationTd);
                tr.appendChild(leaderTd);

                tbody.appendChild(tr);
            });
        }

        document.addEventListener("DOMContentLoaded", fetchAndRenderTable);
    </script>
</head>

<body>
    <div class="container my-4">
        <h2 class="text-center">小组聚会时间表</h2>
        <div class="table-container"> <!-- Makes table horizontally scrollable on mobile -->
            <table class="table table-bordered table-striped" id="data-table">
                <thead>
                    <tr>
                        <th class="custom-header">日期</th>
                        <th class="custom-header">主题</th>
                        <th class="custom-header">地点</th>
                        <th class="custom-header">带领</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Data will be inserted here -->
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>